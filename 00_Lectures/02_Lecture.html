<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="MÃ©nyssa Cherifa-Luron">
<meta name="dcterms.date" content="2024-10-15">

<title>FastAPICourse - Lecture 2 - Building Scalable and Efficient FastAPI Applications</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../00_Lectures/index.html">Lectures</a></li><li class="breadcrumb-item"><a href="../00_Lectures/02_Lecture.html">2. Building Scalable and Efficient FastAPI Applications</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-center sidebar-header">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../images/course_cover.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      <div class="sidebar-tools-main">
    <a href="https://github.com/universdesdonnees" title="GitHub organization" class="quarto-navigation-tool px-1" aria-label="GitHub organization"><i class="bi bi-github"></i></a>
    <a href="https://www.linkedin.com/in/menyssacherifaluron/" title="Menyssa's Linkedin" class="quarto-navigation-tool px-1" aria-label="Menyssa's Linkedin"><i class="bi bi-linkedin"></i></a>
</div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Course information</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Syllabus</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Prerequisites.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Prerequisites</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Lectures</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_Lectures/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_Lectures/01_Lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction to FastAPI &amp; Development Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_Lectures/02_Lecture.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2. Building Scalable and Efficient FastAPI Applications</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../00_Lectures/03_Lecture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Deployment and Production Considerations</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Exercices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_Exercises/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_Exercises/01_Lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_Exercises/02_Lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01_Exercises/03_Lab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Instructors</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02_Instructors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notes</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tldr" id="toc-tldr" class="nav-link active" data-scroll-target="#tldr">TL;DR:</a></li>
  <li><a href="#the-magic-of-asynchronicity" id="toc-the-magic-of-asynchronicity" class="nav-link" data-scroll-target="#the-magic-of-asynchronicity">1. The Magic of Asynchronicity</a>
  <ul class="collapse">
  <li><a href="#synchronous-vs.-asynchronous-execution" id="toc-synchronous-vs.-asynchronous-execution" class="nav-link" data-scroll-target="#synchronous-vs.-asynchronous-execution">1.1. Synchronous vs.&nbsp;Asynchronous Execution</a></li>
  <li><a href="#implementing-asynchronous-endpoints" id="toc-implementing-asynchronous-endpoints" class="nav-link" data-scroll-target="#implementing-asynchronous-endpoints">1.2. Implementing Asynchronous Endpoints</a></li>
  <li><a href="#best-practices-for-asynchronous-programming" id="toc-best-practices-for-asynchronous-programming" class="nav-link" data-scroll-target="#best-practices-for-asynchronous-programming">1.3. Best Practices for Asynchronous Programming</a></li>
  </ul></li>
  <li><a href="#advanced-routing-the-map-of-your-fastapi-world" id="toc-advanced-routing-the-map-of-your-fastapi-world" class="nav-link" data-scroll-target="#advanced-routing-the-map-of-your-fastapi-world">2. Advanced Routing: The Map of Your FastAPI World</a>
  <ul class="collapse">
  <li><a href="#introduction-to-routers" id="toc-introduction-to-routers" class="nav-link" data-scroll-target="#introduction-to-routers">2.1. Introduction to Routers</a></li>
  <li><a href="#path-parameters-and-query-parameters" id="toc-path-parameters-and-query-parameters" class="nav-link" data-scroll-target="#path-parameters-and-query-parameters">2.2. Path Parameters and Query Parameters</a></li>
  <li><a href="#custom-routers-and-middleware" id="toc-custom-routers-and-middleware" class="nav-link" data-scroll-target="#custom-routers-and-middleware">2.3. Custom Routers and Middleware</a></li>
  </ul></li>
  <li><a href="#database-dynamo-powering-your-app" id="toc-database-dynamo-powering-your-app" class="nav-link" data-scroll-target="#database-dynamo-powering-your-app">3. Database Dynamo: Powering Your App</a>
  <ul class="collapse">
  <li><a href="#choosing-the-right-database" id="toc-choosing-the-right-database" class="nav-link" data-scroll-target="#choosing-the-right-database">3.1. Choosing the Right Database</a></li>
  <li><a href="#sqlalchemy-and-sqlmodel" id="toc-sqlalchemy-and-sqlmodel" class="nav-link" data-scroll-target="#sqlalchemy-and-sqlmodel">3.2. SQLAlchemy and SQLModel</a></li>
  <li><a href="#database-migrations-optional" id="toc-database-migrations-optional" class="nav-link" data-scroll-target="#database-migrations-optional">3.3 Database Migrations (Optional)</a></li>
  </ul></li>
  <li><a href="#advanced-topics-toolbox-very-advanced-so-very-optional" id="toc-advanced-topics-toolbox-very-advanced-so-very-optional" class="nav-link" data-scroll-target="#advanced-topics-toolbox-very-advanced-so-very-optional">4. Advanced Topics Toolbox (Very advanced, so very optional)</a>
  <ul class="collapse">
  <li><a href="#dependency-injection" id="toc-dependency-injection" class="nav-link" data-scroll-target="#dependency-injection">4.1. Dependency Injection</a></li>
  <li><a href="#testing-fastapi-applications" id="toc-testing-fastapi-applications" class="nav-link" data-scroll-target="#testing-fastapi-applications">4.2. Testing FastAPI Applications</a></li>
  <li><a href="#security-in-fastapi" id="toc-security-in-fastapi" class="nav-link" data-scroll-target="#security-in-fastapi">4.3. Security in FastAPI</a></li>
  <li><a href="#performance-optimization" id="toc-performance-optimization" class="nav-link" data-scroll-target="#performance-optimization">4.4. Performance Optimization</a></li>
  </ul></li>
  <li><a href="#in-summary" id="toc-in-summary" class="nav-link" data-scroll-target="#in-summary">In Summary</a>
  <ul class="collapse">
  <li><a href="#asynchronicity-the-key-to-responsiveness" id="toc-asynchronicity-the-key-to-responsiveness" class="nav-link" data-scroll-target="#asynchronicity-the-key-to-responsiveness">Asynchronicity: The Key to Responsiveness</a></li>
  <li><a href="#routing-navigating-the-api-landscape" id="toc-routing-navigating-the-api-landscape" class="nav-link" data-scroll-target="#routing-navigating-the-api-landscape">Routing: Navigating the API Landscape</a></li>
  <li><a href="#database-integration-persistence-made-easy" id="toc-database-integration-persistence-made-easy" class="nav-link" data-scroll-target="#database-integration-persistence-made-easy">Database Integration: Persistence Made Easy</a></li>
  <li><a href="#advanced-topics-toolbox-powering-up-your-skills" id="toc-advanced-topics-toolbox-powering-up-your-skills" class="nav-link" data-scroll-target="#advanced-topics-toolbox-powering-up-your-skills">Advanced Topics Toolbox: Powering Up Your Skills</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../00_Lectures/index.html">Lectures</a></li><li class="breadcrumb-item"><a href="../00_Lectures/02_Lecture.html">2. Building Scalable and Efficient FastAPI Applications</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Lecture 2 - Building Scalable and Efficient FastAPI Applications</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>MÃ©nyssa Cherifa-Luron </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="tldr" class="level2">
<h2 class="anchored" data-anchor-id="tldr">TL;DR:</h2>
<p>If youâre short on time, you can listen to the key takeaways from the course in this audio summary:</p>
<div style="text-align: center;">
<figure class="figure">
<figcaption>
Listen to the Audio Overview:
</figcaption>
<audio controls="" src="02_Podcast.wav">
</audio>
<br> <button class="download-btn" onclick="window.location.href='02_Podcast.wav'">Download audio</button><br>

</figure>
</div>
<p>In this lecture, we cover key concepts to enhance your FastAPI development skills:</p>
<ul>
<li><strong>Asynchronous Programming</strong> improves performance by handling multiple tasks simultaneously.</li>
<li><strong>Routing</strong> maps URLs to code, ensuring easy navigation within your API.</li>
<li><strong>Databases</strong> are essential for efficient data storage and retrieval in your applications.</li>
<li><strong>Dependency Injection</strong> promotes modularity, making code easier to maintain and test.</li>
<li><strong>Testing</strong> with tools like <code>pytest</code> ensures your application functions as expected.</li>
<li><strong>Security</strong> through authentication and authorization protects your API from unauthorized access.</li>
<li><strong>Performance Optimization</strong> techniques, such as caching and async enhancements, ensure efficiency under heavy load.</li>
</ul>
<hr>
<p><strong>Your API is a bustling city.</strong></p>
<p>Each street represents a different route, leading to specific destinations (functions or data).</p>
<div style="text-align: center;">
<p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT3LVsLBXvyCaICWy29iarSq2Se66DjGqj6oQ&amp;s" alt="FastAPI logo" style="width: 400px;"></p>
</div>
<p><strong>Asynchronous programming</strong> is like having a fleet of delivery drones zipping around, handling multiple tasks at once. <strong>Databases</strong> are the cityâs bustling warehouses, storing and retrieving valuable information.</p>
<p><strong>Dependency Injection</strong> is like having a reliable supply chain. It ensures that the right components (dependencies) are always available where needed. <strong>Testing</strong> is your quality control department, making sure everything runs smoothly. <strong>Security</strong> is the vigilant police force, protecting your API from hackers and unauthorized access.</p>
<p><strong>Performance optimization</strong> is about keeping the city running smoothly, even during peak hours. Techniques like caching and async enhancements are your traffic management tools, ensuring that everything flows efficiently.</p>
<blockquote class="blockquote">
<p>Are you ready to build your own <strong>API metropolis</strong>?</p>
</blockquote>
<p><strong>Letâs get started!</strong></p>
</section>
<section id="the-magic-of-asynchronicity" class="level2">
<h2 class="anchored" data-anchor-id="the-magic-of-asynchronicity">1. The Magic of Asynchronicity</h2>
<p>Alright, letâs dive into the world of asynchronicity, where things happenâ¦ but they donât always wait around for you. Get ready for some tech magic!</p>
<section id="synchronous-vs.-asynchronous-execution" class="level3">
<h3 class="anchored" data-anchor-id="synchronous-vs.-asynchronous-execution">1.1. Synchronous vs.&nbsp;Asynchronous Execution</h3>
<p>In a synchronous world, youâre the chef cooking one dish at a time. You canât start the next meal until the first is finished and deliveredâslow, right?</p>
<div style="text-align: center;">
<p><img src="https://www.astera.com/wp-content/uploads/2023/01/Async-vs-Sync-API.png" alt="FastAPI logo" style="width: 400px;"></p>
</div>
<p>Now, welcome to the <strong>asynchronous kitchen</strong>!</p>
<p>Here, while one dish is cooking (waiting on I/O*, like boiling water), you can start prepping the next one. FastAPI does this for your appâit doesnât wait idly for the oven to preheat before taking on new tasks.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Note: I/O">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note: I/O
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I/O in computing stands for âInput/Outputâ. It refers to the communication between a computer system and the outside world, or between different components within a system. Hereâs a brief overview:</p>
<p><strong>Definition</strong> : I/O is the process of transferring data to or from a computer system.</p>
<p><strong>Types</strong></p>
<ol type="1">
<li><p><strong>Hard I/O</strong>: Direct transfer of data between a computer and an external physical device (e.g., keyboard, mouse).</p></li>
<li><p><strong>Soft I/O</strong>: Data transfer between computers or servers over a network.</p></li>
</ol>
<p><strong>Characteristics</strong></p>
<ul>
<li><p><strong>Bidirectional</strong>: Some devices can function as both input and output devices.</p></li>
<li><p><strong>Perspective-based</strong>: Whether a device is considered input or output can depend on the perspective.</p></li>
</ul>
<p><strong>Examples</strong></p>
<ul>
<li><p>Input devices: Keyboards, mice, scanners</p></li>
<li><p>Output devices: Monitors, printers, speakers</p></li>
<li><p>I/O devices: Hard drives, network cards</p></li>
</ul>
<p><strong>Importance</strong> : I/O operations are crucial for user interaction, data transfer, and system performance. Understanding I/O is essential for developers and system administrators for system design, performance optimization, and troubleshooting.</p>
</div>
</div>
</div>
<p>Hereâs the technical breakdown:</p>
<ul>
<li><p><strong>Synchronous Execution</strong> is like cooking one meal from start to finish before even thinking about the next one. Itâs linearâone task finishes, and only then does the next begin.</p></li>
<li><p><strong>Asynchronous Execution</strong> is like juggling multiple orders at once. While one task waits for something (say, file reading or a web request), the event loop jumps to the next task, keeping everything moving!</p></li>
</ul>
<p><strong>Event loop</strong> is the master chef in charge, making sure no task burns by hopping from one to another.</p>
<p>And <strong>coroutines</strong> are those tasksâitâs like each dish being prepped. They tell the event loop,</p>
<blockquote class="blockquote">
<p>Iâm gonna be busy for a while, feel free to go check on the others.</p>
</blockquote>
<p>The benefit? FastAPI can handle a huge number of requests quickly, without getting bogged down in waiting, making your app zippy and responsive, even when under heavy load.</p>
</section>
<section id="implementing-asynchronous-endpoints" class="level3">
<h3 class="anchored" data-anchor-id="implementing-asynchronous-endpoints">1.2. Implementing Asynchronous Endpoints</h3>
<p>Okay, letâs jump into FastAPIâs version of cooking up some asynchronous magic.</p>
<p>To make a route <strong>asynchronous</strong>, we use the keywords <code>async</code> and <code>await</code>âtheyâre like the VIP passes to FastAPIâs asynchronous event.</p>
<ul>
<li><strong><code>async</code></strong>: This tells Python that a function might take a while to complete, and itâs cool to check out other functions while waiting.</li>
<li><strong><code>await</code></strong>: Itâs like a signal flare. It tells the event loop, âHey, Iâm waiting for this task to finish, but you donât need to hang around! Come back later.â</li>
</ul>
<p>Hereâs a sample:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/async-dish"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> cook_something():</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> prep_ingredients()  <span class="co"># Might take time</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> bake_dish()  <span class="co"># Another wait here</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"status"</span>: <span class="st">"Dish ready!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>See how we use <code>await</code> to tell the event loop to handle other things while it waits for the cooking functions to finish?</p>
<blockquote class="blockquote">
<p>Thatâs the magic sauce!</p>
</blockquote>
<p>Letâs whip up more examples to help you better understand how to use <code>async</code> and <code>await</code> in FastAPI!</p>
<p>These will showcase different ways you can handle async operations in routes.</p>
<ol type="1">
<li><strong>Simulating Multiple Async Operations in Parallel</strong></li>
</ol>
<p>Letâs say youâre preparing different parts of a meal simultaneously. While the oven is baking the dish, youâre also mixing the salad, and getting drinks ready.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio  <span class="co"># For running tasks concurrently</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> bake_dish():</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="dv">3</span>)  <span class="co"># Simulate baking time</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Dish baked"</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> prepare_salad():</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="dv">1</span>)  <span class="co"># Simulate chopping veggies</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Salad ready"</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_drinks():</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="dv">2</span>)  <span class="co"># Simulate fetching drinks</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"Drinks ready"</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/prepare-meal"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> prepare_meal():</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Run all tasks at the same time using asyncio.gather</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    dish, salad, drinks <span class="op">=</span> <span class="cf">await</span> asyncio.gather(</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        bake_dish(),</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        prepare_salad(),</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        get_drinks()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"status"</span>: <span class="ss">f"</span><span class="sc">{</span>dish<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>salad<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>drinks<span class="sc">}</span><span class="ss">!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: In this example, instead of waiting for each task (baking, salad prep, drinks) to finish one by one, weâre using <code>asyncio.gather()</code> to run all of them in parallel. The event loop jumps between these tasks while theyâre waiting for something, maximizing efficiency.</p>
<ol start="2" type="1">
<li><strong>Using Async with External API Calls</strong></li>
</ol>
<p>Now, youâre pulling recipe data from a remote service. You donât want your server to stop everything and wait while it fetches the data, so we make that operation asynchronous.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpx</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/fetch-recipe"</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> fetch_recipe():</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="cf">with</span> httpx.AsyncClient() <span class="im">as</span> client:</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> client.get(<span class="st">'https://recipe-api.com/special-dish'</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> response.json()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"recipe"</span>: data}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: With <code>httpx.AsyncClient()</code>, weâre making the API call non-blocking. While the app waits for the recipe service to respond, the event loop is free to handle other requests. This is essential when working with third-party services to prevent your application from getting âstuckâ waiting.</p>
<ol start="3" type="1">
<li><strong>Asynchronous File Reading</strong></li>
</ol>
<p>You can read files asynchronously so other requests donât have to wait in line while your server is reading a large file.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> aiofiles  <span class="co"># Async library for file I/O</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/read-steps"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> read_steps():</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">async</span> <span class="cf">with</span> aiofiles.<span class="bu">open</span>(<span class="st">'recipe.txt'</span>, mode<span class="op">=</span><span class="st">'r'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> <span class="cf">await</span> <span class="bu">file</span>.read()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"recipe_steps"</span>: content}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: Here, weâre using <code>aiofiles</code> to open and read a file asynchronously. This allows FastAPI to handle other requests while reading the file in the background.</p>
<ol start="4" type="1">
<li><strong>Delayed Responses: Simulating Long Operations</strong></li>
</ol>
<p>Suppose you have a task that simulates a long operation, like slow cooking. You donât want your app to freeze while waiting for the slow cook to finish, so you implement it asynchronously.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio  <span class="co"># For simulating a delay</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/slow-cook"</span>)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> slow_cook():</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="dv">5</span>)  <span class="co"># Simulate a long task (e.g., slow cooking)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"status"</span>: <span class="st">"Slow-cooked meal is ready!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: In this case, the <code>asyncio.sleep(5)</code> simulates a task that takes time (like slow cooking). While this is happening, FastAPI doesnât sit idleâit can handle other requests while the slow-cooked meal finishes. ð¢ð¥ð²</p>
<ol start="5" type="1">
<li><strong>Asynchronous Error Handling in Tasks</strong></li>
</ol>
<p>What if something goes wrong during one of your asynchronous tasks? For example, youâre preparing a cake but the oven breaks down midway. Letâs handle that gracefully using <code>async</code> and <code>try-except</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> asyncio</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> bake_cake():</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> asyncio.sleep(<span class="dv">2</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">"Oven malfunctioned!"</span>)  <span class="co"># Something went wrong</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/bake-cake"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> prepare_cake():</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> bake_cake()</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"status"</span>: <span class="st">"Cake baked successfully!"</span>}</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"Oops! </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: In this example, the oven âmalfunctionsâ during the cake-baking process. The <code>try-except</code> block catches the error, allowing us to return a helpful message instead of crashing the app. This is like having a backup plan in case your cake flops.</p>
<ol start="6" type="1">
<li><strong>Handling CPU-bound Tasks with Async + Background Tasks</strong></li>
</ol>
<p>While asynchronous tasks are great for I/O-bound operations (like waiting on APIs or files), CPU-bound operations (like heavy computations) can block the event loop. To avoid this, we can offload such tasks to background workers.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, BackgroundTasks</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time  <span class="co"># Simulate CPU-bound task</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> heavy_computation():</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">10</span>)  <span class="co"># Simulate a long-running computation</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Computation done!"</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/start-computation"</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> start_computation(background_tasks: BackgroundTasks):</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    background_tasks.add_task(heavy_computation)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"status"</span>: <span class="st">"Computation started in the background!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: Here, <code>BackgroundTasks</code> allows us to offload the heavy computation (CPU-bound) to a background task so it doesnât block the event loop. This way, FastAPI can continue processing other requests without waiting for the long-running computation to finish.</p>
<p>By using <code>async</code> and <code>await</code> correctly, you make your FastAPI apps <em>super efficient</em>, like a pro chef in a fast-paced kitchen, always juggling tasks without missing a beat!</p>
</section>
<section id="best-practices-for-asynchronous-programming" class="level3">
<h3 class="anchored" data-anchor-id="best-practices-for-asynchronous-programming">1.3. Best Practices for Asynchronous Programming</h3>
<p>When it comes to asynchronous programming, itâs not just about sprinkling <code>async</code> and <code>await</code> everywhere. Thereâs a bit of finesse to itâjust like any good recipe.</p>
<ol type="1">
<li><strong>Know when to go async</strong>:</li>
</ol>
<ul>
<li>Use async for <strong>I/O-bound</strong> tasks: things that need to wait for something external, like network requests or reading files.</li>
<li>Donât go async for <strong>CPU-bound</strong> tasks (heavy number crunching), because while your function is churning away, youâre not gaining any advantage from asyncâs multitasking magic.</li>
</ul>
<ol start="2" type="1">
<li><strong>Error handling in asynchronous functions</strong></li>
</ol>
<p>Think of error handling as catching a wayward dish before it hits the ground. In asynchronous code, make sure to wrap tasks in <code>try-except</code> blocks, so your event loop doesnât trip over unhandled exceptions.</p>
<div style="text-align: center;">
<p><img src="https://helper.beedev-services.com/images/python/try_and_except.png" alt="FastAPI logo" style="width: 400px;"></p>
</div>
<p>Hereâs how to handle errors asynchronously:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> serve_dish():</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">await</span> bake_cake()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> OvenFailureException:</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"status"</span>: <span class="st">"Oven exploded! Call for help!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li><strong>Simple try-except in an Asynchronous Function</strong></li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpx</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/get-recipe"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_recipe():</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> httpx.get(<span class="st">"https://random-recipes.com/cake"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()  <span class="co"># Raise an error if the request failed</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"recipe"</span>: response.json()}</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> httpx.HTTPStatusError <span class="im">as</span> e:</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"Recipe not available! Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"Unexpected error occurred: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: Here, weâre using <code>httpx</code> to make an asynchronous HTTP request. If the recipe website is down or returns an error, the <code>HTTPStatusError</code> exception will trigger, and we handle it smoothly without crashing the app.</p>
<ol start="2" type="1">
<li><strong>Handling Multiple Exceptions</strong></li>
</ol>
<p>Sometimes, different errors need different solutions. Letâs say your app reads data from a file and makes an HTTP request, both of which can fail in different ways.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> aiofiles  <span class="co"># Asynchronous file handling</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpx</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/read-data"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> read_data():</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Try reading from a file asynchronously</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">async</span> <span class="cf">with</span> aiofiles.<span class="bu">open</span>(<span class="st">"data.txt"</span>, mode<span class="op">=</span><span class="st">"r"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            contents <span class="op">=</span> <span class="cf">await</span> <span class="bu">file</span>.read()</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Then, make a web request for additional info</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> <span class="cf">await</span> httpx.get(<span class="st">"https://api.example.com/data"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>        response.raise_for_status()</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"file_data"</span>: contents, <span class="st">"api_data"</span>: response.json()}</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="st">"File not found. Please check the file path."</span>}</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> httpx.RequestError <span class="im">as</span> e:</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"Failed to reach API: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"An unexpected error occurred: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: - <strong>FileNotFoundError</strong>: Happens if the file doesnât exist. We handle this separately with a user-friendly message. - <strong>httpx.RequestError</strong>: Happens if the API request fails (e.g., bad connection). We give a clear message indicating the API issue.</p>
<ol start="3" type="1">
<li><strong>Retry Mechanism with <code>try-except</code></strong></li>
</ol>
<p>Letâs say youâre dealing with flaky internet, and you want to retry a failed task a couple of times before giving up. You can create a loop with retries inside your <code>try-except</code> block.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> httpx</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/retry-request"</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> retry_request():</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    retries <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> attempt <span class="kw">in</span> <span class="bu">range</span>(retries):</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> <span class="cf">await</span> httpx.get(<span class="st">"https://api.slow-server.com/data"</span>)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            response.raise_for_status()</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"data"</span>: response.json()}</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> httpx.RequestError <span class="im">as</span> e:</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> attempt <span class="op">&lt;</span> retries <span class="op">-</span> <span class="dv">1</span>:  <span class="co"># Only retry if we haven't exhausted attempts</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                <span class="cf">continue</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"Failed after </span><span class="sc">{</span>retries<span class="sc">}</span><span class="ss"> attempts. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: Here, the <code>try-except</code> block runs in a loop. If the request fails, the function will retry up to 3 times before giving up and returning an error.</p>
<ol start="4" type="1">
<li><strong>Chaining <code>async</code> Calls with <code>try-except</code></strong></li>
</ol>
<p>Letâs say you need to perform several asynchronous tasks, and you want to catch errors at different points.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_ingredients():</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simulating an asynchronous function</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"flour"</span>: <span class="dv">1</span>, <span class="st">"sugar"</span>: <span class="dv">2</span>, <span class="st">"eggs"</span>: <span class="dv">3</span>}</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> prepare_dough(ingredients):</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"eggs"</span> <span class="kw">not</span> <span class="kw">in</span> ingredients:</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Missing eggs!"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pretend we're making dough</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"dough prepared"</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/make-cake"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> make_cake():</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        ingredients <span class="op">=</span> <span class="cf">await</span> get_ingredients()</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        dough <span class="op">=</span> <span class="cf">await</span> prepare_dough(ingredients)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"status"</span>: <span class="ss">f"</span><span class="sc">{</span>dough<span class="sc">}</span><span class="ss">, ready for baking!"</span>}</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"Invalid ingredients: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"An unexpected error occurred: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: - We first get ingredients asynchronously. - Then we prepare the dough asynchronously. - If thereâs an issue (e.g., missing ingredients), we raise a <strong>ValueError</strong> and catch it, returning a helpful error message.</p>
<ol start="5" type="1">
<li><strong>Nested <code>try-except</code> for More Granular Control</strong></li>
</ol>
<p>Letâs get more advanced. Sometimes, you need different try-except blocks for different stages of your async workflow.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> aiofiles</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/complex-process"</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> complex_process():</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Stage 1: File read</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">async</span> <span class="cf">with</span> aiofiles.<span class="bu">open</span>(<span class="st">"input.txt"</span>, mode<span class="op">=</span><span class="st">"r"</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                contents <span class="op">=</span> <span class="cf">await</span> <span class="bu">file</span>.read()</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"error"</span>: <span class="st">"Input file missing!"</span>}</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Stage 2: Process data</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Fake processing step</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> contents:</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"File is empty!"</span>)</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            processed_data <span class="op">=</span> contents.upper()</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">ValueError</span> <span class="im">as</span> e:</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"Data processing failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Stage 3: Return response</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"processed_data"</span>: processed_data}</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"error"</span>: <span class="ss">f"An unexpected error occurred: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong></p>
<p>Here, we have different try-except blocks:</p>
<ol type="1">
<li><p><strong>File reading</strong> (handles file errors separately).</p></li>
<li><p><strong>Data processing</strong> (checks content validity).</p></li>
<li><p>A final catch-all to handle anything unexpected.</p></li>
</ol>
<p>This allows us to give very specific error messages, depending on where things go wrong.</p>
<p>In the world of FastAPI, asynchronicity is like having an army of chefs helping you cook multiple meals at once. You save time, resources, and keep things running smoothly.</p>
<p>Just remember:</p>
<blockquote class="blockquote">
<p>use async when it makes sense, manage your I/O carefully, and make sure youâve got error-handling oven mitts at the ready!</p>
</blockquote>
</section>
</section>
<section id="advanced-routing-the-map-of-your-fastapi-world" class="level2">
<h2 class="anchored" data-anchor-id="advanced-routing-the-map-of-your-fastapi-world">2. Advanced Routing: The Map of Your FastAPI World</h2>
<p>Routing is the backbone of FastAPIâlike a GPS guiding every request to its destination.</p>
<p>In this part, weâll dive into routers, parameters, and middleware to organize and streamline your FastAPI applications.</p>
<p>Get ready for a journey through the âhighwaysâ of FastAPI! ðð¨</p>
<section id="introduction-to-routers" class="level3">
<h3 class="anchored" data-anchor-id="introduction-to-routers">2.1. Introduction to Routers</h3>
<p>Letâs start by breaking down routers.</p>
<p>Think of them as different sections of a city: each router is responsible for handling related endpoints, like the âshopping districtâ or âresidential zoneâ of your app.</p>
<p>In a simple project, you might only need a single <code>main.py</code> to handle all routes. But as your app grows, it becomes necessary to group routes logicallyâby features or services. FastAPI provides <code>APIRouter</code> to help you do just that.</p>
<p>Hereâs a basic example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, APIRouter</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new router for user-related routes</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>user_router <span class="op">=</span> APIRouter()</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="at">@user_router.get</span>(<span class="st">"/users/"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_users():</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"users"</span>: [<span class="st">"MÃ©nyssa"</span>, <span class="st">"Eric"</span>, <span class="st">"Paul"</span>]}</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="at">@user_router.get</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_user(user_id: <span class="bu">int</span>):</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"user"</span>: user_id}</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Include the user_router in the main FastAPI app</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>app.include_router(user_router)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Current Project Structure</strong></p>
<p>Right now, you have a very simple project structure:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> env/</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> main.py</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Letâs refactor it to make use of routers. Create a folder to hold all your route files:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> env/</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> main.py</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> routers/         <span class="co"># New folder to store routers</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="ex">â</span>   âââ users.py     <span class="co"># New file for user-related routes</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Inside <code>users.py</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> APIRouter</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>user_router <span class="op">=</span> APIRouter()</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="at">@user_router.get</span>(<span class="st">"/users/"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_users():</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"users"</span>: [<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>]}</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="at">@user_router.get</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_user(user_id: <span class="bu">int</span>):</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"user"</span>: user_id}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, include this router in <code>main.py</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> routers.users <span class="im">import</span> user_router</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>app.include_router(user_router)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now youâve separated concerns and logically grouped your endpoints. This makes your app easier to scale and maintain!</p>
<p><strong>Organizing Endpoints into Logical Groups</strong></p>
<p>You can create more routers for different areas of your app, like <code>products.py</code> for managing a product catalog or <code>orders.py</code> for processing orders. This modular approach keeps things clean, especially as the number of endpoints grows.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> env/</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> main.py</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> routers/</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="ex">â</span>   âââ users.py</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="ex">â</span>   âââ products.py</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="ex">â</span>   âââ orders.py</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="ex">âââ</span> requirements.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each router becomes a dedicated zone of your app, handling its own logic. This modularity is a huge win for maintainability and scalability.</p>
</section>
<section id="path-parameters-and-query-parameters" class="level3">
<h3 class="anchored" data-anchor-id="path-parameters-and-query-parameters">2.2. Path Parameters and Query Parameters</h3>
<p>Parameters allow users to send extra information with requests, making them more flexible and dynamic. <a href="../00_Lectures/01_Lecture.html">See also Lecture 1</a></p>
<p><strong>Path Parameters</strong></p>
<p>Path parameters are part of the URL. They let you capture dynamic parts of a route. For example, if you have <code>/users/{user_id}</code>, <code>{user_id}</code> is a path parameter.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="at">@user_router.get</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_user(user_id: <span class="bu">int</span>):</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"user"</span>: user_id}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: Here, <code>user_id</code> is extracted from the URL and passed as an argument to the handler function.</p>
<p><strong>Query Parameters</strong></p>
<p>Query parameters are key-value pairs that follow a <code>?</code> in the URL. Theyâre usually used to filter or sort data.</p>
<p>For example, if you have <code>/users?name=Paul</code>, <code>name</code> is a query parameter:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="at">@user_router.get</span>(<span class="st">"/users/"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_users(name: <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span>):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> name:</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"filtered_user"</span>: name}</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"users"</span>: [<span class="st">"MÃ©nyssa"</span>, <span class="st">"Eric"</span>, <span class="st">"Paul"</span>]}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: Here, <code>name</code> is a query parameter that filters the list of users. If no <code>name</code> is provided, it returns the full list.</p>
<p><strong>Validating Parameters with Dependency Injection</strong></p>
<p>FastAPIâs dependency injection system allows you to validate parameters before they reach the route handler. For example, you can use <code>Pydantic</code> models to validate query parameters:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserQueryParams(BaseModel):</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    age: <span class="bu">int</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="at">@user_router.get</span>(<span class="st">"/search/"</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> search_users(params: UserQueryParams):</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"name"</span>: params.name, <span class="st">"age"</span>: params.age}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With dependency injection, FastAPI will automatically validate the query parameters based on the <code>UserQueryParams</code> schema.</p>
</section>
<section id="custom-routers-and-middleware" class="level3">
<h3 class="anchored" data-anchor-id="custom-routers-and-middleware">2.3. Custom Routers and Middleware</h3>
<p>Letâs now explore how to extend routers and add middleware to handle more advanced use cases.</p>
<p><strong>Creating Custom Routers for Specific Use Cases</strong></p>
<p>You can create custom routers for specific sections of your app, each with its own set of routes and logic.</p>
<p>For instance, letâs create an admin router with custom logic:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> APIRouter</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>admin_router <span class="op">=</span> APIRouter()</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="at">@admin_router.get</span>(<span class="st">"/admin/reports"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_admin_reports():</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"report"</span>: <span class="st">"Admin report data"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: This custom router can be used to separate admin functionality from general user functionality. It helps ensure the right people access the right routes.</p>
<p><strong>Implementing Middleware for Cross-Cutting Concerns</strong></p>
<p>Middleware is code that runs <strong>before</strong> or <strong>after</strong> each request. Itâs great for logging, authentication, and other cross-cutting concerns.</p>
<p>Hereâs an example of middleware that logs the time taken for each request:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.middleware</span>(<span class="st">"http"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> log_requests(request, call_next):</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    start_time <span class="op">=</span> time.time()</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> <span class="cf">await</span> call_next(request)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    duration <span class="op">=</span> time.time() <span class="op">-</span> start_time</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Request: </span><span class="sc">{</span>request<span class="sc">.</span>url<span class="sc">}</span><span class="ss">, Duration: </span><span class="sc">{</span>duration<span class="sc">}</span><span class="ss">s"</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: With this middleware, every request gets timed and logged. Middleware is powerful because it can intercept every request and response, applying logic that affects the entire app.</p>
<p><strong>Bonus: Custom Error Handling with Middleware</strong> You can even use middleware for custom error handling. For example, you might want to catch all exceptions and return a custom error message:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.middleware</span>(<span class="st">"http"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> custom_error_handling(request, call_next):</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cf">await</span> call_next(request)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> JSONResponse(status_code<span class="op">=</span><span class="dv">500</span>, content<span class="op">=</span>{<span class="st">"error"</span>: <span class="bu">str</span>(e)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: This middleware catches any unhandled exceptions and returns a consistent error response to the client.</p>
<p>By organizing your FastAPI app into logical pieces and implementing advanced routing techniques, youâll keep your code clean and scalableâlike a well-mapped city!</p>
</section>
</section>
<section id="database-dynamo-powering-your-app" class="level2">
<h2 class="anchored" data-anchor-id="database-dynamo-powering-your-app">3. Database Dynamo: Powering Your App</h2>
<p>This is the heart of most web applications : The database.</p>
<p>Itâs the powerful engine that drives the storage and retrieval of your data, and in this section, weâll explore how to set up, manage, and interact with databases in FastAPI.</p>
<section id="choosing-the-right-database" class="level3">
<h3 class="anchored" data-anchor-id="choosing-the-right-database">3.1. Choosing the Right Database</h3>
<p>Choosing the right database is like choosing the right vehicle for a road trip:</p>
<blockquote class="blockquote">
<p>Do you want a rugged SUV (NoSQL) or a precision-engineered sports car (SQL)?</p>
</blockquote>
<p>It all depends on the type of data, how itâs structured, and what you need in terms of performance.</p>
<p><strong>SQL vs.&nbsp;NoSQL Databases</strong></p>
<ul>
<li><strong>SQL</strong>: Think of SQL databases like Excel sheetsâtheyâre great for structured data with clear relationships. You can run complex queries across multiple tables, and theyâre backed by solid ACID compliance (Atomicity, Consistency, Isolation, Durability). Common options include <strong>PostgreSQL</strong>, <strong>MySQL</strong>, and <strong>SQLite</strong>.</li>
</ul>
<p>â¡ï¸ <strong>Use case</strong>: Banking systems, e-commerce platforms where data integrity and relationships matter.</p>
<ul>
<li><strong>NoSQL</strong>: NoSQL databases, on the other hand, are more like dynamic, flexible containers. They can handle semi-structured or unstructured data like JSON documents. They scale horizontally, which means they work great with massive datasets.</li>
</ul>
<p>â¡ï¸ <strong>Use case</strong>: Social networks, real-time applications, or scenarios where data structure is constantly changing (e.g., <strong>MongoDB</strong>, <strong>Cassandra</strong>).</p>
<p><strong>Popular Databases for FastAPI</strong></p>
<p>When it comes to FastAPI, the database world is your oyster. Here are some great options:</p>
<ul>
<li><p><strong>PostgreSQL</strong>: The SQL superstar! Itâs powerful, open-source, and works smoothly with FastAPI. Great for complex queries, relational data, and transactional applications.</p></li>
<li><p><strong>MongoDB</strong>: NoSQL king! Ideal for flexible, large-scale applications where the structure isnât rigid. Use it if youâre dealing with JSON-like data or want to easily scale horizontally.</p></li>
<li><p><strong>SQLite</strong>: Lightweight and portable SQL option. Best for smaller applications or quick prototypes. Itâs built into Python, so no additional setup required.</p></li>
</ul>
<p><strong>Analogy Time</strong>:</p>
<ul>
<li><p><strong>SQL databases</strong> are like libraries, neatly organized with sections, rows, and books that reference other books (relational).</p></li>
<li><p><strong>NoSQL databases</strong> are like a garage sale where things might not be perfectly organized, but you can grab what you need quickly (flexibility).</p></li>
</ul>
</section>
<section id="sqlalchemy-and-sqlmodel" class="level3">
<h3 class="anchored" data-anchor-id="sqlalchemy-and-sqlmodel">3.2. SQLAlchemy and SQLModel</h3>
<p>FastAPI makes working with databases easy, thanks to <strong><a href="https://fastapi.tiangolo.com/tutorial/sql-databases/">SQLAlchemy</a></strong> and <strong><a href="https://sqlmodel.tiangolo.com/">SQLModel</a></strong>.</p>
<p>Letâs break them down and see how they power up your database interactions.</p>
<section id="using-sqlalchemy-for-database-interactions" class="level4">
<h4 class="anchored" data-anchor-id="using-sqlalchemy-for-database-interactions">3.2.1. Using SQLAlchemy for Database Interactions</h4>
<p>SQLAlchemy is one of the most powerful and flexible libraries for working with relational databases in Python. It gives you fine-grained control over every aspect of database interaction.</p>
<div style="text-align: center;">
<p><img src="https://miro.medium.com/v2/resize:fit:720/format:webp/0*2gcZYBv6jmcbRtnY" alt="FastAPI logo" style="width: 400px;"></p>
</div>
<p>Itâs an <strong>ORM</strong>* (Object Relational Mapper) that lets you work with databases in a Pythonic wayâno more raw SQL queries unless you want to.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Note: ORM">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note: ORM
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><strong>ORM stands for Object-Relational Mapper.</strong> Itâs a programming technique that bridges the gap between object-oriented programming (OOP) and relational databases.</p>
<p><strong>In simpler terms, an ORM allows you to interact with database tables as if they were objects in your programming language.</strong> This means you can use familiar OOP concepts like classes, objects, and methods to create, read, update, and delete data in your database.</p>
<p><strong>Hereâs how it works:</strong></p>
<ol type="1">
<li><strong>Mapping:</strong> The ORM defines a mapping between your object classes and database tables. This mapping specifies how properties of your objects correspond to columns in the database table.</li>
<li><strong>Data Access:</strong> You can use your objectâs methods to perform database operations. For example, to save an object, you might call a <code>save()</code> method. The ORM will automatically translate this into the appropriate SQL query to insert data into the database.</li>
<li><strong>Data Retrieval:</strong> To retrieve data from the database, you can query for objects based on certain criteria. The ORM will translate your query into SQL and return the results as objects.</li>
</ol>
<p><strong>Benefits of using ORMs:</strong></p>
<ul>
<li><p><strong>Simplified development:</strong> ORMs can significantly reduce the amount of boilerplate code needed to interact with databases.</p></li>
<li><p><strong>Improved productivity:</strong> By using familiar OOP concepts, developers can work more efficiently and make fewer errors.</p></li>
<li><p><strong>Portability:</strong> ORMs can often be used with different databases, making it easier to switch between systems.</p></li>
<li><p><strong>Abstraction:</strong> ORMs provide a layer of abstraction between your application and the database, making your code more maintainable and easier to test.</p></li>
</ul>
<p><strong>Popular ORMs include:</strong></p>
<ul>
<li>SQLAlchemy for Python</li>
<li>Hibernate for Java</li>
<li>Entity Framework for .NET</li>
<li>ActiveRecord for Ruby</li>
</ul>
<p><strong>By using an ORM, you can focus on building your applicationâs logic without having to worry about the intricacies of SQL and database interactions.</strong></p>
</div>
</div>
</div>
<p>Letâs break this down step by step to make it super clear. Weâll start with the basics of creating a table and then move into interacting with that table using SQLAlchemy.</p>
<p><strong>1. Define a SQLAlchemy Model (Table Representation)</strong></p>
<p>In a database, a <strong>table</strong> stores data in rows and columns. In SQLAlchemy, we create a <strong>model</strong> that acts like a blueprint for a database table.</p>
<p>Whatâs happening in the code:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine, Column, Integer, String</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy.ext.declarative <span class="im">import</span> declarative_base</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy.orm <span class="im">import</span> sessionmaker</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>create_engine</code></strong>: Think of this as your connection to the database. In this example, weâre using <strong>SQLite</strong>, which is a lightweight, file-based SQL database (though this could be PostgreSQL, MySQL, etc.). The engine is the bridge between SQLAlchemy and the actual database.</li>
<li><strong><code>declarative_base</code></strong>: This is the starting point for any model in SQLAlchemy. We use it to define tables. The <code>Base</code> class lets SQLAlchemy know which classes (tables) should be mapped to the database.</li>
<li><strong><code>sessionmaker</code></strong>: This is a factory for creating sessions, which are used to talk to the database (weâll get to sessions later).</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to a SQLite database (or PostgreSQL)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> create_engine(<span class="st">"sqlite:///mydb.db"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>Base <span class="op">=</span> declarative_base()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><strong><code>engine = create_engine("sqlite:///mydb.db")</code></strong>: This line creates the connection to the SQLite database, which is stored in a file called <code>mydb.db</code>. If you were using PostgreSQL, the string would look something like this:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> create_engine(<span class="st">"postgresql://username:password@localhost/dbname"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong><code>Base = declarative_base()</code></strong>: This creates the base class <code>Base</code>, which weâll use to define all our tables (models) in the future.</p></li>
</ul>
<p><strong>2. Defining the <code>User</code> Table</strong></p>
<p>Now, letâs create the <strong>User</strong> table:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a model representing a table</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User(Base):</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    __tablename__ <span class="op">=</span> <span class="st">"users"</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> Column(Integer, primary_key<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> Column(String, index<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong><code>class User(Base)</code></strong> defines a class <code>User</code> that inherits from <code>Base</code>. Each class in SQLAlchemy is mapped to a table in the database, so this class is our blueprint for the <code>users</code> table.</li>
<li><strong><code>__tablename__ = "users"</code></strong> sets the table name to <code>"users"</code>. Whenever we query or modify data, this table name is used in the background.</li>
</ul>
<p>Inside this class, we define <strong>columns</strong>, which are the fields in our table: - <strong><code>id = Column(Integer, primary_key=True, index=True)</code></strong> creates an <code>id</code> column in the table, which is an <strong>integer</strong>, the <strong>primary key</strong> (unique for each row), and indexed for fast lookups. - <strong><code>name = Column(String, index=True)</code></strong> creates a <code>name</code> column that stores <strong>strings</strong> (text) and is also indexed.</p>
<p><strong>3. Create the Table in the Database</strong></p>
<p>Now that weâve defined our <code>User</code> model, we need to actually create the table in the database:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table in the database</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>Base.metadata.create_all(bind<span class="op">=</span>engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: <strong><code>Base.metadata.create_all(bind=engine)</code></strong> tells SQLAlchemy to take all the models weâve defined (in this case, the <code>User</code> model) and create the corresponding tables in the database connected to <code>engine</code>. This will create the <code>users</code> table in <code>mydb.db</code>.</p>
<p><strong>4.Interacting with the Database (CRUD Operations)</strong></p>
<p>Once our table is created, we can start performing <strong>CRUD operations</strong> (Create, Read, Update, Delete) to interact with our data.</p>
<p>To communicate with the database, we need a <strong>session</strong>. A session is like a temporary workspace where we can make changes to the database, and once weâre done, we can <strong>commit</strong> (save) those changes.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a session to interact with the database</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>SessionLocal <span class="op">=</span> sessionmaker(autocommit<span class="op">=</span><span class="va">False</span>, autoflush<span class="op">=</span><span class="va">False</span>, bind<span class="op">=</span>engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: Here, we define <strong>SessionLocal</strong>, a session factory that will let us create sessions when we need them.</p>
<p><strong>5. Adding Data to the Database</strong></p>
<p>Letâs use this session to add a new user to the <code>users</code> table:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a session and add a new user</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> SessionLocal()</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>new_user <span class="op">=</span> User(name<span class="op">=</span><span class="st">"MÃ©nyssa"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>db.add(new_user)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>db.commit()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>db.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong><code>db = SessionLocal()</code></strong>create a new session using <code>SessionLocal()</code>. This session allows us to interact with the database.</li>
<li><strong><code>new_user = User(name="MÃ©nyssa")</code></strong> create a new instance of the <code>User</code> model. In this case, weâre adding a user with the name <strong>MÃ©nyssa</strong>. The <code>id</code> column will be automatically generated because itâs a primary key.</li>
<li><strong><code>db.add(new_user)</code></strong> add this new user to our session (this step only adds it to the session, not the database yet).</li>
<li><strong><code>db.commit()</code></strong> saves (commits) the changes to the database. The new user is now stored in the <code>users</code> table.</li>
<li><strong><code>db.close()</code></strong> close the session to free up resources.</li>
</ul>
<p><strong>Summary of CRUD Operations</strong></p>
<ol type="1">
<li><strong>Define a SQLAlchemy Model</strong> (This represents a table in your database):</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy <span class="im">import</span> create_engine, Column, Integer, String</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy.ext.declarative <span class="im">import</span> declarative_base</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlalchemy.orm <span class="im">import</span> sessionmaker</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Connect to a SQLite database (or PostgreSQL)</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> create_engine(<span class="st">"sqlite:///mydb.db"</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>Base <span class="op">=</span> declarative_base()</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a model representing a table</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User(Base):</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    __tablename__ <span class="op">=</span> <span class="st">"users"</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> Column(Integer, primary_key<span class="op">=</span><span class="va">True</span>, index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> Column(String, index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table in the database</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>Base.metadata.create_all(bind<span class="op">=</span>engine)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a session to interact with the database</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>SessionLocal <span class="op">=</span> sessionmaker(autocommit<span class="op">=</span><span class="va">False</span>, autoflush<span class="op">=</span><span class="va">False</span>, bind<span class="op">=</span>engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><strong>Interacting with the Database</strong>: Now that weâve created a table, letâs add some users:</li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a session and add a new user</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> SessionLocal()</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>new_user <span class="op">=</span> User(name<span class="op">=</span><span class="st">"Pierre"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>db.add(new_user)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>db.commit()</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>db.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>SQLAlchemy simplifies database interactions by letting you work with Python objects rather than raw SQL queries, making it easier to manage your appâs data.</p>
</section>
<section id="sqlmodel-the-best-of-both-worlds-sqlalchemy-pydantic" class="level4">
<h4 class="anchored" data-anchor-id="sqlmodel-the-best-of-both-worlds-sqlalchemy-pydantic">3.2.2. SQLModel: The Best of Both Worlds (SQLAlchemy + Pydantic)</h4>
<p>While SQLAlchemy is powerful, <strong>SQLModel</strong> takes things a step further by combining the simplicity of <strong>Pydantic</strong> (for data validation) and the power of SQLAlchemy.</p>
<p>SQLModel is built on top of SQLAlchemy but introduces <strong>Pydantic-style validation</strong>. It takes the best parts of both worlds: - The powerful ORM capabilities of SQLAlchemy - The data validation magic of Pydantic</p>
<blockquote class="blockquote">
<p>So, what does this mean? You get to use SQLAlchemyâs robust features while reducing the boilerplate code, <strong>and</strong> you get automatic data validation.</p>
</blockquote>
<p><strong>1. Key Differences with SQLAlchemy:</strong></p>
<ul>
<li><strong>Data Validation Built-In</strong>: SQLModel integrates Pydanticâs data validation. This means that every time you define a model, it automatically validates the data for you.</li>
<li><strong>Less Boilerplate</strong>: SQLModel cuts down on repetitive code. You donât need to define columns manually like in SQLAlchemy; you can use Pythonâs type hints, making your code cleaner and easier to maintain.</li>
<li><strong>Declarative Syntax</strong>: You define your models in a more <strong>Pythonic</strong> way, without needing to write repetitive column definitions.</li>
<li><strong>Pydantic + SQLAlchemy Integration</strong>: SQLModel works seamlessly with FastAPI, because FastAPI is already built on Pydantic for data validation.</li>
</ul>
<p><strong>2. SQLModel Example Breakdown</strong></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel, Field, create_engine</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User(SQLModel, table<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(default<span class="op">=</span><span class="va">None</span>, primary_key<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><p><strong><code>SQLModel</code></strong> is the base class for all your models. It inherits from both <strong>Pydantic</strong> and <strong>SQLAlchemy</strong>, so it does the heavy lifting for you.</p></li>
<li><p><strong><code>table=True</code></strong> tells SQLModel to treat this class as a <strong>database table</strong>. Without it, the class would just be a data model for validation purposes.</p></li>
<li><p><strong>Fields</strong>:</p>
<ul>
<li><strong><code>id: int = Field(default=None, primary_key=True)</code></strong>: Instead of defining the column type manually (like in SQLAlchemy), we use type hints (<code>int</code> for <code>id</code> and <code>str</code> for <code>name</code>) and the <code>Field</code> function from Pydantic for additional options like <code>primary_key=True</code>.</li>
<li><strong><code>name: str</code></strong>: This defines a simple <code>name</code> column with a <code>string</code> type.</li>
</ul></li>
</ul>
<p>Already, this feels cleaner and more Pythonic.</p>
<p>Hereâs a full script using <strong>SQLModel</strong> to create a SQLite database, define a <code>User</code> model, and perform basic CRUD operations.</p>
<p>This will give you a complete picture of how SQLModel works in practice:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, Depends, HTTPException</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel, Field, create_engine, Session, select</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uvicorn  <span class="co"># Import uvicorn to run the application</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define the User model using SQLModel</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User(SQLModel, table<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(default<span class="op">=</span><span class="va">None</span>, primary_key<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create the SQLite database engine</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>DATABASE_URL <span class="op">=</span> <span class="st">"sqlite:///./mydb.db"</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> create_engine(DATABASE_URL, echo<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create the database tables</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>SQLModel.metadata.create_all(engine)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Create a session to interact with the database</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_session():</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Session(engine) <span class="im">as</span> session:</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> session</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a root route to prevent the 404 error</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/"</span>)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_root():</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"Welcome to the User Management API!"</span>}</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Add a new user to the database</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="at">@app.post</span>(<span class="st">"/users/"</span>, response_model<span class="op">=</span>User)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_user(name: <span class="bu">str</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>    new_user <span class="op">=</span> User(name<span class="op">=</span>name)</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    session.add(new_user)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    session.commit()</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    session.refresh(new_user)</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_user</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Fetch all users from the database</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/users/"</span>, response_model<span class="op">=</span><span class="bu">list</span>[User])</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_users(session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>    statement <span class="op">=</span> select(User)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> session.<span class="bu">exec</span>(statement)</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>    users <span class="op">=</span> results.<span class="bu">all</span>()</span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> users</span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Update a user in the database</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a><span class="at">@app.put</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>, response_model<span class="op">=</span>User)</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_user(user_id: <span class="bu">int</span>, new_name: <span class="bu">str</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> session.get(User, user_id)</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user:</span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">404</span>, detail<span class="op">=</span><span class="st">"User not found"</span>)</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>    user.name <span class="op">=</span> new_name</span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>    session.add(user)</span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>    session.commit()</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>    session.refresh(user)</span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Delete a user from the database</span></span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="at">@app.delete</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>)</span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete_user(user_id: <span class="bu">int</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> session.get(User, user_id)</span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user:</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">404</span>, detail<span class="op">=</span><span class="st">"User not found"</span>)</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>    session.delete(user)</span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>    session.commit()</span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"detail"</span>: <span class="st">"User deleted"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Big, big Explanation</strong></p>
<p>Letâs break down the key parts of your FastAPI script to provide a clear understanding of its structure and functionality:</p>
<ol type="1">
<li><strong>Imports</strong></li>
</ol>
<div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, Depends, HTTPException</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel, Field, create_engine, Session, select</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uvicorn  <span class="co"># Import uvicorn to run the application</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>FastAPI</strong>: The main framework used to create the API.</li>
<li><strong>Depends</strong>: A helper to declare dependencies for your path operations (like database sessions).</li>
<li><strong>HTTPException</strong>: Used to raise HTTP errors with a specified status code and message.</li>
<li><strong>SQLModel</strong>: A library that combines Pydantic and SQLAlchemy for data modeling and database operations.</li>
<li><strong>Field</strong>: A function to define the fields of a SQLModel class.</li>
<li><strong>create_engine</strong>: Used to create a database engine.</li>
<li><strong>Session</strong>: Represents a workspace for interacting with the database.</li>
<li><strong>select</strong>: A function used to create SQL SELECT statements.</li>
<li><strong>uvicorn</strong>: An ASGI server used to run your FastAPI application.</li>
</ul>
<ol start="2" type="1">
<li><strong>Creating the FastAPI App</strong></li>
</ol>
<div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>FastAPI Instance</strong>: This line initializes the FastAPI application. This instance will handle all the incoming requests.</li>
</ul>
<ol start="3" type="1">
<li><strong>Defining the User Model</strong></li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User(SQLModel, table<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(default<span class="op">=</span><span class="va">None</span>, primary_key<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>User Class</strong>: This class defines the <code>User</code> model as a database table.</li>
<li><strong><code>table=True</code></strong>: Indicates that this class should be treated as a database table.</li>
<li><strong>Fields</strong>:
<ul>
<li><strong><code>id</code></strong>: An integer that serves as the primary key (automatically incremented).</li>
<li><strong><code>name</code></strong>: A string representing the userâs name.</li>
</ul></li>
</ul>
<ol start="4" type="1">
<li><strong>Creating the Database Engine</strong></li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>DATABASE_URL <span class="op">=</span> <span class="st">"sqlite:///./mydb.db"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> create_engine(DATABASE_URL, echo<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>DATABASE_URL</strong>: Specifies the connection string for the SQLite database (using a file named <code>mydb.db</code>).</li>
<li><strong><code>create_engine</code></strong>: Creates the database engine that allows the application to interact with the database. The <code>echo=True</code> flag enables logging of all the generated SQL statements.</li>
</ul>
<ol start="5" type="1">
<li><strong>Creating Database Tables</strong></li>
</ol>
<div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>SQLModel.metadata.create_all(engine)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>This line creates all tables defined in the SQLModel classes in the database. If the table already exists, it will not be recreated.</li>
</ul>
<ol start="6" type="1">
<li><strong>Creating a Database Session</strong></li>
</ol>
<div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_session():</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Session(engine) <span class="im">as</span> session:</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> session</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong><code>get_session</code> function</strong>: A generator function that creates a database session for each request. It ensures that the session is properly managed (opened and closed).</li>
</ul>
<ol start="7" type="1">
<li><strong>Root Route</strong></li>
</ol>
<div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_root():</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"Welcome to the User Management API!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Root Endpoint</strong>: A simple GET endpoint that returns a welcome message. This prevents the 404 error when accessing the root URL.</li>
</ul>
<ol start="8" type="1">
<li><strong>Adding a New User</strong></li>
</ol>
<div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.post</span>(<span class="st">"/users/"</span>, response_model<span class="op">=</span>User)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_user(name: <span class="bu">str</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    new_user <span class="op">=</span> User(name<span class="op">=</span>name)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    session.add(new_user)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    session.commit()</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    session.refresh(new_user)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_user</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>POST Endpoint</strong>: Adds a new user to the database.</li>
<li><strong><code>name: str</code></strong>: The name of the user is received as a path parameter.</li>
<li><strong><code>session: Session = Depends(get_session)</code></strong>: Injects a session dependency into the function.</li>
<li><strong>Creating and Committing</strong>: The new user is created, added to the session, committed to the database, and returned as a response.</li>
</ul>
<ol start="9" type="1">
<li><strong>Fetching All Users</strong></li>
</ol>
<div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/users/"</span>, response_model<span class="op">=</span><span class="bu">list</span>[User])</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_users(session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    statement <span class="op">=</span> select(User)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> session.<span class="bu">exec</span>(statement)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    users <span class="op">=</span> results.<span class="bu">all</span>()</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> users</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>GET Endpoint</strong>: Fetches all users from the database.</li>
<li><strong>SQL Select Statement</strong>: Uses the <code>select</code> function to create a query and executes it.</li>
<li><strong>Returns</strong>: A list of all user records.</li>
</ul>
<ol start="10" type="1">
<li><strong>Updating a User</strong></li>
</ol>
<div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.put</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>, response_model<span class="op">=</span>User)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_user(user_id: <span class="bu">int</span>, new_name: <span class="bu">str</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> session.get(User, user_id)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user:</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">404</span>, detail<span class="op">=</span><span class="st">"User not found"</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    user.name <span class="op">=</span> new_name</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    session.add(user)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    session.commit()</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    session.refresh(user)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>PUT Endpoint</strong>: Updates the name of an existing user identified by <code>user_id</code>.</li>
<li><strong>Error Handling</strong>: If the user is not found, raises a 404 HTTP exception.</li>
<li><strong>Session Management</strong>: Updates the user object, commits changes, and returns the updated user.</li>
</ul>
<ol start="11" type="1">
<li><strong>Deleting a User</strong></li>
</ol>
<div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.delete</span>(<span class="st">"/users/</span><span class="sc">{user_id}</span><span class="st">"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> delete_user(user_id: <span class="bu">int</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> session.get(User, user_id)</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user:</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">404</span>, detail<span class="op">=</span><span class="st">"User not found"</span>)</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    session.delete(user)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    session.commit()</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"detail"</span>: <span class="st">"User deleted"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>DELETE Endpoint</strong>: Deletes the user identified by <code>user_id</code>.</li>
<li><strong>Error Handling</strong>: If the user is not found, raises a 404 HTTP exception.</li>
<li><strong>Session Management</strong>: Deletes the user and commits the changes.</li>
</ul>
<p>The use of FastAPIâs dependency injection for database sessions and structured error handling ensures a robust application. Each endpoint is clearly defined and returns data in a structured format, making it easy to use and extend.</p>
<p><strong>5. Why Use SQLModel in FastAPI Projects?</strong></p>
<p>SQLModel was designed with <strong>FastAPI</strong> in mind. Hereâs why itâs a great fit for FastAPI projects:</p>
<ul>
<li><strong>Seamless Integration with FastAPI</strong>: Both FastAPI and SQLModel use <strong>Pydantic</strong> under the hood, so the models you define in SQLModel work perfectly with FastAPIâs request/response validation system.</li>
<li><strong>Automatic Data Validation</strong>: SQLModel automatically validates incoming and outgoing data, which fits beautifully with FastAPIâs validation-first philosophy.</li>
<li><strong>Reduced Boilerplate</strong>: You write less code compared to raw SQLAlchemy. For example, you donât need to specify columns explicitly, and everything integrates smoothly with FastAPI.</li>
</ul>
</section>
<section id="summary-sqlalchemy-vs.-sqlmodel" class="level4">
<h4 class="anchored" data-anchor-id="summary-sqlalchemy-vs.-sqlmodel">3.2.3 Summary: SQLAlchemy vs.&nbsp;SQLModel</h4>
<table class="table">
<colgroup>
<col style="width: 24%">
<col style="width: 35%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>SQLAlchemy</th>
<th>SQLModel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Data Validation</strong></td>
<td>Separate (manually or with Pydantic)</td>
<td>Built-in with Pydantic</td>
</tr>
<tr class="even">
<td><strong>Syntax</strong></td>
<td>More verbose (manually define columns)</td>
<td>Simpler, using Python type hints</td>
</tr>
<tr class="odd">
<td><strong>FastAPI Integration</strong></td>
<td>Works, but not designed for it</td>
<td>Seamlessly integrated</td>
</tr>
<tr class="even">
<td><strong>Boilerplate Code</strong></td>
<td>More boilerplate (defining columns)</td>
<td>Less boilerplate (uses type hints + Pydantic)</td>
</tr>
<tr class="odd">
<td><strong>Primary Use Case</strong></td>
<td>Large, complex applications</td>
<td>FastAPI apps, quick development</td>
</tr>
</tbody>
</table>
<p>In essence, <strong>SQLAlchemy</strong> gives you more control for complex applications, but if youâre working with <strong>FastAPI</strong>, <strong>SQLModel</strong> makes everything cleaner, simpler, and fasterâ<strong>without sacrificing power</strong>. Itâs like having a Swiss Army knife thatâs perfectly sharpened for FastAPIâs needs.</p>
</section>
</section>
<section id="database-migrations-optional" class="level3">
<h3 class="anchored" data-anchor-id="database-migrations-optional">3.3 Database Migrations (Optional)</h3>
<p>Database migrations are crucial for managing changes to your database schema as your application evolves.</p>
<section id="managing-database-schema-changes" class="level4">
<h4 class="anchored" data-anchor-id="managing-database-schema-changes">3.1. Managing Database Schema Changes</h4>
<p><strong><a href="https://jod35.github.io/fastapi-beyond-crud-docs/site/chapter7/?h=alembic#database-migrations-with-alembic">Alembic</a></strong> is a lightweight database migration tool for use with SQLAlchemy. It helps you version control your database schema changes and makes it easier to apply these changes across different environments.</p>
<p><strong>Key Features of Alembic:</strong></p>
<ol type="1">
<li><p><strong>Version Control</strong>: Each migration script is like a <strong>bookmark</strong> in your treeâs growth. It tells you exactly how the branches have changed over time. You can easily look back to see when a new feature was added or an old one was removed.</p></li>
<li><p><strong>Autogeneration</strong>: With Alembic, you donât have to manually write every migration script. Itâs like having a <strong>smart assistant</strong> who automatically detects changes in your models and drafts the migration scripts for you. Imagine saying, âHey Alembic, I added a new leaf!â and it responds with a complete plan to incorporate that leaf into your tree.</p></li>
<li><p><strong>Consistent Environments</strong>: Alembic ensures that whether youâre working in your cozy development environment or the bustling production stage, everyone is looking at the same beautiful tree. It keeps all developers and environments in sync, avoiding those dreaded âIt works on my machine!â moments.</p></li>
</ol>
<p><strong>The Power of Alembic in Your Hands</strong></p>
<p>While Alembic might feel optional for small projects, itâs like having a <strong>safety net</strong> when you decide to jump into more complex applications.</p>
<p>Imagine youâve planted a tiny sapling today, but a year later, itâs a full-fledged tree with multiple branchesâsome may need to be reshaped or removed.</p>
<p>By implementing Alembic from the start, you save yourself from headaches down the line as your application grows.</p>
<p>So, whether youâre just starting out or scaling to new heights, think of Alembic as your trusty tool to manage database changes, keeping everything neat, organized, and growing beautifully!</p>
</section>
<section id="step-by-step-guide" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-guide">3.2. Step-by-Step Guide</h4>
<p><strong>1. Installing Alembic</strong></p>
<p>First, install Alembic via pip:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install alembic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>2. Setting Up Alembic</strong></p>
<p>Initialize Alembic in your FastAPI project. Run this command in your terminal:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alembic</span> init alembic</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This creates a new directory called <code>alembic</code>, which contains configuration files and a folder for your migration scripts.</p>
<p><strong>3. Configuring Alembic</strong></p>
<p>In the <code>alembic.ini</code> file, set the database URL to match your FastAPI project:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[alembic]</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># A generic, single database configuration.</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="dt">sqlalchemy.url </span><span class="ot">=</span><span class="st"> sqlite:///./mydb.db</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You should also modify the <code>env.py</code> file in the <code>alembic</code> folder to work with SQLModel. Replace the line:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> myapp <span class="im">import</span> mymodel</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>with:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> myapp.models <span class="im">import</span> User  <span class="co"># Import your SQLModel classes here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Make sure to import the base metadata:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>target_metadata <span class="op">=</span> SQLModel.metadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>4. Creating a Migration</strong></p>
<p>When you modify your models (for example, adding a new column), create a migration script:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alembic</span> revision <span class="at">--autogenerate</span> <span class="at">-m</span> <span class="st">"Add email column to users"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command creates a new migration file in the <code>alembic/versions</code> directory with the changes detected by Alembic.</p>
<p><strong>Example: Adding an Email Column to User Model</strong></p>
<p>Letâs say you want to add an <code>email</code> column to your <code>User</code> model. Update your <code>User</code> model like this:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel, Field</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User(SQLModel, table<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(default<span class="op">=</span><span class="va">None</span>, primary_key<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    email: <span class="bu">str</span> <span class="op">=</span> Field(default<span class="op">=</span><span class="va">None</span>)  <span class="co"># New email field</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>After saving this change, run the Alembic command to generate a migration:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alembic</span> revision <span class="at">--autogenerate</span> <span class="at">-m</span> <span class="st">"Add email column to users"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Alembic generates a migration script similar to the following:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">"""Add email column to users</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">Revision ID: 123456789abc</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">Revises: previous_revision_id</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">Create Date: 2024-10-11 12:00:00.000000</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">"""</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> alembic <span class="im">import</span> op</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlalchemy <span class="im">as</span> sa</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co"># revision identifiers, used by Alembic.</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>revision <span class="op">=</span> <span class="st">'123456789abc'</span></span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>down_revision <span class="op">=</span> <span class="st">'previous_revision_id'</span></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>branch_labels <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>depends_on <span class="op">=</span> <span class="va">None</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upgrade():</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adding the email column</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>    op.add_column(<span class="st">'user'</span>, sa.Column(<span class="st">'email'</span>, sa.String(), nullable<span class="op">=</span><span class="va">True</span>))</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> downgrade():</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dropping the email column</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>    op.drop_column(<span class="st">'user'</span>, <span class="st">'email'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>5. Applying the Migration</strong></p>
<p>Once youâve created the migration script, apply it to your database:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">alembic</span> upgrade head</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command runs the <code>upgrade</code> function in your migration script, applying the changes to your database.</p>
<p>By following these steps, you can effectively manage your database schema changes as your application grows and evolves. Now that we have a robust migration strategy in place, itâs time to delve into more advanced topics that enhance our applicationâs architecture and functionality.</p>
</section>
</section>
</section>
<section id="advanced-topics-toolbox-very-advanced-so-very-optional" class="level2">
<h2 class="anchored" data-anchor-id="advanced-topics-toolbox-very-advanced-so-very-optional">4. Advanced Topics Toolbox (Very advanced, so very optional)</h2>
<p>Youâve made it this farâwell done! ð</p>
<p>Now weâre diving into the supercharged section, where we tackle some <strong>seriously advanced topics</strong> in FastAPI.</p>
<p>These are the power tools that can turn you from a solid developer into a FastAPI <strong>wizard</strong>.</p>
<p>Theyâre optional, but if youâre up for the challenge, youâll come out with a toolbox of knowledge that will let you <strong>build, secure, and optimize</strong> APIs like a pro.</p>
<p>Letâs open the toolbox:</p>
<section id="dependency-injection" class="level3">
<h3 class="anchored" data-anchor-id="dependency-injection">4.1. Dependency Injection</h3>
<blockquote class="blockquote">
<p>âWhy do we need it?â<br>
Think of <strong>dependency injection</strong> like getting a superpower to âinjectâ exactly what your code needs, when it needs it, without unnecessary clutter! Itâs all about clean, maintainable code that scales with your project.</p>
</blockquote>
<ul>
<li><p><strong>Understanding Dependency Injection in FastAPI</strong><br>
Youâll see how FastAPI makes managing dependencies a breeze. Instead of cluttering up your logic with repetitive calls, you inject them cleanly.</p></li>
<li><p><strong>Using <code>fastapi.Depends</code> for Dependency Injection</strong><br>
Youâll learn how to simplify your code by using the <code>Depends</code> methodâlike ordering takeout for your appâs resources instead of cooking every time.</p></li>
<li><p><strong>Creating Custom Dependencies</strong><br>
Why stop at the basics? Learn to create your own custom dependencies, from database connections to third-party API calls.</p></li>
</ul>
<section id="what-is-dependency-injection-di" class="level4">
<h4 class="anchored" data-anchor-id="what-is-dependency-injection-di">4.1.1 What is Dependency Injection (DI)?</h4>
<p>In FastAPI, DI helps you inject dependencies into your routes and functions without having to create them manually each time.</p>
<p>The magic happens using <strong><code>Depends</code></strong>.</p>
</section>
<section id="fastapis-depends-in-action" class="level4">
<h4 class="anchored" data-anchor-id="fastapis-depends-in-action">4.1.2 FastAPIâs <code>Depends</code> in Action</h4>
<p>FastAPI uses <strong><code>Depends</code></strong> to handle dependency injection in a clean and Pythonic way. Letâs look at how it works:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, Depends</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a dependency</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_db_connection():</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"db"</span>: <span class="st">"connected"</span>}</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the dependency in an endpoint</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/items/"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_items(db_conn <span class="op">=</span> Depends(get_db_connection)):</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="ss">f"Database status: </span><span class="sc">{</span>db_conn[<span class="st">'db'</span>]<span class="sc">}</span><span class="ss">"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong><code>get_db_connection()</code></strong>: This function simulates connecting to a database.</li>
<li><strong><code>Depends(get_db_connection)</code></strong>: The <code>Depends()</code> function calls our dependency and âinjectsâ its return value into the route.</li>
<li>Now, the <code>db_conn</code> variable has access to the database connection without having to create it inside the route.</li>
</ul>
</section>
<section id="custom-dependencies" class="level4">
<h4 class="anchored" data-anchor-id="custom-dependencies">4.1.3 Custom Dependencies</h4>
<p>FastAPI isnât just limited to database connections! You can create your own custom dependencies to manage <strong>authentication</strong>, <strong>logging</strong>, <strong>configuration</strong>, and more.</p>
<p>Letâs build a simple <em>authorization</em> dependency:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> HTTPException, Header</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> verify_token(x_token: <span class="bu">str</span> <span class="op">=</span> Header(...)):</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x_token <span class="op">!=</span> <span class="st">"supersecrettoken"</span>:</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">403</span>, detail<span class="op">=</span><span class="st">"Invalid token"</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/secure-data/"</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> secure_data(token <span class="op">=</span> Depends(verify_token)):</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"You have access to secure data!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><p><strong><code>verify_token()</code></strong>: This function checks if the token provided in the <code>x_token</code> header is correct.</p></li>
<li><p><strong><code>Depends(verify_token)</code></strong>: If the token is valid, the user can access the secure route. If not, it raises an error.</p></li>
</ul>
</section>
</section>
<section id="testing-fastapi-applications" class="level3">
<h3 class="anchored" data-anchor-id="testing-fastapi-applications">4.2. Testing FastAPI Applications</h3>
<blockquote class="blockquote">
<p>âYour code worksâ¦ but does it really?â<br>
Testing is like <strong>proofreading</strong> for developers. Sure, your app runs on your machine, but what about production? What about edge cases? ð¤</p>
</blockquote>
<ul>
<li><p><strong>Unit Testing, Integration Testing, and API Testing</strong><br>
Get familiar with different types of tests and when to use them. Unit tests are like checking individual LEGO bricks, while integration tests check the full LEGO model.</p></li>
<li><p><strong>Using Tools like pytest for Testing</strong><br>
Learn the magic of <code>pytest</code>âyour testing buddy! From simple tests to mocking dependencies, weâll cover it all.</p></li>
</ul>
<section id="why-is-testing-important" class="level4">
<h4 class="anchored" data-anchor-id="why-is-testing-important">4.2.1 Why is Testing Important?</h4>
<p>Imagine launching a rocket without checking if all the parts workâscary, right? In development, itâs the same! Testing ensures that your code behaves as expected, so you donât end up with unexpected bugs in production.</p>
<p><strong>Types of Testing</strong> :</p>
<ol type="1">
<li><strong>Unit Testing</strong>: Test individual components of your code (e.g., a function or a class) to make sure they behave correctly in isolation.</li>
<li><strong>Integration Testing</strong>: Test how different parts of your application work together (e.g., database, API, external services).</li>
<li><strong>API Testing</strong>: Specifically focus on testing the endpoints of your FastAPI app to ensure they return the right responses and handle errors gracefully.</li>
</ol>
</section>
<section id="setting-up-pytest" class="level4">
<h4 class="anchored" data-anchor-id="setting-up-pytest">4.2.2 Setting Up Pytest</h4>
<p>FastAPI plays well with <strong>pytest</strong>, one of the most popular testing frameworks in Python. Itâs simple, powerful, and easy to integrate.</p>
<ol type="1">
<li><strong>Install pytest</strong>:</li>
</ol>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install pytest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><strong>Install TestClient from FastAPI</strong>: FastAPI has a built-in <strong>TestClient</strong> (powered by Starlette) that you can use to send HTTP requests during testing.</li>
</ol>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install httpx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="writing-your-first-unit-test" class="level4">
<h4 class="anchored" data-anchor-id="writing-your-first-unit-test">4.2.3 Writing Your First Unit Test</h4>
<p>Letâs start small by writing a unit test for a simple FastAPI route.</p>
<p><strong>Hereâs your API:</strong></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/hello/"</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_hello():</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"Hello, World!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Writing the Test:</strong></p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.testclient <span class="im">import</span> TestClient</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> myapp <span class="im">import</span> app  <span class="co"># Assuming your app is defined in 'myapp.py'</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> TestClient(app)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_read_hello():</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> client.get(<span class="st">"/hello/"</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> response.status_code <span class="op">==</span> <span class="dv">200</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> response.json() <span class="op">==</span> {<span class="st">"message"</span>: <span class="st">"Hello, World!"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong>TestClient</strong>: This allows us to simulate HTTP requests to the FastAPI app during tests.</li>
<li><strong><code>client.get("/hello/")</code></strong>: We send a GET request to the <code>/hello/</code> route.</li>
<li><strong>Assertions</strong>: We check if the responseâs status code is 200 (OK) and if the response data matches <code>{"message": "Hello, World!"}</code>.</li>
</ul>
</section>
<section id="writing-integration-tests" class="level4">
<h4 class="anchored" data-anchor-id="writing-integration-tests">4.2.4 Writing Integration Tests</h4>
<p>Now, letâs take things up a notch. Weâll write an integration test for an endpoint that interacts with a database.</p>
<p><strong>API to Test:</strong></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, Depends</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel, Session, create_engine, Field, select</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> User(SQLModel, table<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span>: <span class="bu">int</span> <span class="op">=</span> Field(primary_key<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>engine <span class="op">=</span> create_engine(<span class="st">"sqlite:///./test.db"</span>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_session():</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> Session(engine) <span class="im">as</span> session:</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">yield</span> session</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="at">@app.post</span>(<span class="st">"/users/"</span>)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_user(name: <span class="bu">str</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> User(name<span class="op">=</span>name)</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    session.add(user)</span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    session.commit()</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> user</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Writing the Integration Test</strong>:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pytest</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.testclient <span class="im">import</span> TestClient</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sqlmodel <span class="im">import</span> SQLModel, Session</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> myapp <span class="im">import</span> app, engine</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> TestClient(app)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="at">@pytest.fixture</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> setup_db():</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set up the database before each test</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    SQLModel.metadata.create_all(engine)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Tear down the database after each test</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>    SQLModel.metadata.drop_all(engine)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_create_user(setup_db):</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> client.post(<span class="st">"/users/"</span>, json<span class="op">=</span>{<span class="st">"name"</span>: <span class="st">"Alice"</span>})</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> response.status_code <span class="op">==</span> <span class="dv">200</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> response.json()</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> data[<span class="st">"name"</span>] <span class="op">==</span> <span class="st">"Alice"</span></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="st">"id"</span> <span class="kw">in</span> data  <span class="co"># Check that the user has an id</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong><code>setup_db()</code></strong>: A pytest fixture that sets up and tears down the database for each test. This ensures that your tests always start with a clean slate.</li>
<li><strong>Integration Test</strong>: We simulate a POST request to create a new user and verify that the response data contains the expected user name and a generated ID.</li>
</ul>
</section>
<section id="mocking-dependencies-in-tests" class="level4">
<h4 class="anchored" data-anchor-id="mocking-dependencies-in-tests">4.2.5 Mocking Dependencies in Tests</h4>
<p>Sometimes, you donât want to test every part of your app during unit tests. Maybe you donât want to hit the actual database but want to <strong>mock</strong> the database connection instead. Hereâs how you can do it:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> unittest.mock <span class="im">import</span> MagicMock</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> Depends</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fake_get_session():</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> MagicMock()  <span class="co"># Mocked database session</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">yield</span> db</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="at">@app.post</span>(<span class="st">"/fake-user/"</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_fake_user(name: <span class="bu">str</span>, session <span class="op">=</span> Depends(fake_get_session)):</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    session.add(name)  <span class="co"># Add a name to the mocked session</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="ss">f"User </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> added"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong><code>MagicMock()</code></strong>: A utility from the <code>unittest</code> library that allows us to mock dependencies like database connections.</li>
<li><strong>Fake Dependency</strong>: We use the fake session during testing to ensure we donât interact with the real database.</li>
</ul>
</section>
<section id="testing-summary" class="level4">
<h4 class="anchored" data-anchor-id="testing-summary">4.2.6 Testing Summary</h4>
<ul>
<li><strong>Unit tests</strong>: Test individual components in isolation.</li>
<li><strong>Integration tests</strong>: Ensure that different parts of your app work well together.</li>
<li><strong>TestClient</strong>: Allows you to simulate HTTP requests to your FastAPI app.</li>
<li><strong>Pytest</strong>: A powerful testing framework that integrates seamlessly with FastAPI.</li>
<li><strong>Mocking</strong>: Helps you isolate your tests from real dependencies.</li>
</ul>
</section>
</section>
<section id="security-in-fastapi" class="level3">
<h3 class="anchored" data-anchor-id="security-in-fastapi">4.3. Security in FastAPI</h3>
<blockquote class="blockquote">
<p>âLocks on the door, security cameras on the house.â<br>
Security is <strong>non-negotiable</strong>. No one wants their API hacked or misused! Youâll learn how to <strong>protect</strong> your FastAPI app from common vulnerabilities.</p>
</blockquote>
<blockquote class="blockquote">
<blockquote class="blockquote">
<p>âWho are you? And what are you allowed to do?â<br>
FastAPI makes handling <strong>authentication</strong> and <strong>authorization</strong> simple, but donât be fooledâitâs a crucial topic.</p>
</blockquote>
</blockquote>
<ul>
<li><p><strong>Authentication and Authorization</strong><br>
Keep the wrong people out and make sure the right people can only do what theyâre supposed to do.</p></li>
<li><p><strong>Protecting Against Common Vulnerabilities</strong><br>
Weâll go over real-world threats like <strong>SQL injection</strong>, <strong>XSS</strong>, and <strong>CSRF</strong>, and how to defend against them. Think of it as locking all the windows before leaving your house.</p></li>
<li><p><strong>Input Validation and Sanitization</strong><br>
Clean your data like youâd wash your handsâalways! No messy, untrusted input allowed.</p></li>
<li><p><strong>Secure Coding Practices</strong><br>
Itâs like learning to cook without burning your kitchen down. Follow best practices to keep your app safe.</p></li>
</ul>
<section id="the-importance-of-security-in-apis" class="level4">
<h4 class="anchored" data-anchor-id="the-importance-of-security-in-apis">4.3.1 The Importance of Security in APIs</h4>
<p>Your API is like the front door to your application, and just like your house, you want to make sure itâs locked and secure. Poor security practices can expose sensitive data, compromise user privacy, and leave your app vulnerable to attacks. With FastAPI, implementing security features is not only crucial but also relatively straightforward.</p>
</section>
<section id="authentication-vs.-authorization" class="level4">
<h4 class="anchored" data-anchor-id="authentication-vs.-authorization">4.3.2 <strong>Authentication vs.&nbsp;Authorization</strong></h4>
<ul>
<li><strong>Authentication</strong>: Who are you? Authentication is the process of verifying the identity of a user or system.</li>
<li><strong>Authorization</strong>: What are you allowed to do? Authorization is about determining what actions a verified user can perform.</li>
</ul>
<p>Think of authentication as checking a ticket at a concert and authorization as making sure you can access the VIP lounge.</p>
<p><strong>Authentication in FastAPI</strong></p>
<p>FastAPI provides several methods for authentication. One of the most popular and secure ways is <strong>token-based authentication</strong> using JWT (JSON Web Tokens). Letâs dive into an example:</p>
<ol type="1">
<li><p><strong>Installing the Required Package</strong>: <code>bash     pip install pyjwt</code></p></li>
<li><p><strong>Creating the Token</strong>: Hereâs how you can generate and validate a JWT for user authentication.</p></li>
</ol>
<div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI, Depends, HTTPException</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi.security <span class="im">import</span> OAuth2PasswordBearer</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> jose <span class="im">import</span> JWTError, jwt</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Secret key to encode/decode JWT</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>SECRET_KEY <span class="op">=</span> <span class="st">"mysecretkey"</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>ALGORITHM <span class="op">=</span> <span class="st">"HS256"</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Mock user database</span></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>fake_users_db <span class="op">=</span> {</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"user1"</span>: {<span class="st">"username"</span>: <span class="st">"user1"</span>, <span class="st">"hashed_password"</span>: <span class="st">"fakehashedpassword"</span>}</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a><span class="co"># OAuth2 scheme</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>oauth2_scheme <span class="op">=</span> OAuth2PasswordBearer(tokenUrl<span class="op">=</span><span class="st">"token"</span>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_access_token(data: <span class="bu">dict</span>):</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Create JWT token."""</span></span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> jwt.encode(data, SECRET_KEY, algorithm<span class="op">=</span>ALGORITHM)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a><span class="at">@app.post</span>(<span class="st">"/token"</span>)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> login(form_data: OAuth2PasswordRequestForm <span class="op">=</span> Depends()):</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Login and return JWT token."""</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    user <span class="op">=</span> fake_users_db.get(form_data.username)</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> user:</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">400</span>, detail<span class="op">=</span><span class="st">"Invalid credentials"</span>)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate token with user data</span></span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a>    token <span class="op">=</span> create_access_token({<span class="st">"sub"</span>: form_data.username})</span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"access_token"</span>: token, <span class="st">"token_type"</span>: <span class="st">"bearer"</span>}</span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-34"><a href="#cb68-34" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/users/me"</span>)</span>
<span id="cb68-35"><a href="#cb68-35" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_user(token: <span class="bu">str</span> <span class="op">=</span> Depends(oauth2_scheme)):</span>
<span id="cb68-36"><a href="#cb68-36" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Get current user based on JWT token."""</span></span>
<span id="cb68-37"><a href="#cb68-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb68-38"><a href="#cb68-38" aria-hidden="true" tabindex="-1"></a>        payload <span class="op">=</span> jwt.decode(token, SECRET_KEY, algorithms<span class="op">=</span>[ALGORITHM])</span>
<span id="cb68-39"><a href="#cb68-39" aria-hidden="true" tabindex="-1"></a>        username: <span class="bu">str</span> <span class="op">=</span> payload.get(<span class="st">"sub"</span>)</span>
<span id="cb68-40"><a href="#cb68-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> username <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb68-41"><a href="#cb68-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">401</span>, detail<span class="op">=</span><span class="st">"Invalid token"</span>)</span>
<span id="cb68-42"><a href="#cb68-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {<span class="st">"username"</span>: username}</span>
<span id="cb68-43"><a href="#cb68-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> JWTError:</span>
<span id="cb68-44"><a href="#cb68-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">401</span>, detail<span class="op">=</span><span class="st">"Invalid token"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong>JWT Token</strong>: A JWT token is generated when a user logs in, and this token is used to authenticate the user in future requests.</li>
<li><strong>OAuth2PasswordBearer</strong>: FastAPIâs built-in method to handle OAuth2-based authentication, which works perfectly with JWT.</li>
<li><strong>Token Endpoint</strong>: <code>/token</code> is where users will exchange their credentials for a token.</li>
<li><strong>Token Validation</strong>: The token is decoded on subsequent requests to validate the userâs identity.</li>
</ul>
<p><strong>Authorization: Controlling Access</strong></p>
<p>Once you have authentication in place, the next step is<strong>authorizationâmaking sure users can only access what they are allowed to</strong>.</p>
<p>Letâs add some roles to our users and restrict certain routes based on these roles:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> Depends</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>roles_db <span class="op">=</span> {</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"user1"</span>: {<span class="st">"role"</span>: <span class="st">"admin"</span>},</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"user2"</span>: {<span class="st">"role"</span>: <span class="st">"user"</span>}</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_current_user(token: <span class="bu">str</span> <span class="op">=</span> Depends(oauth2_scheme)):</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    payload <span class="op">=</span> jwt.decode(token, SECRET_KEY, algorithms<span class="op">=</span>[ALGORITHM])</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    username: <span class="bu">str</span> <span class="op">=</span> payload.get(<span class="st">"sub"</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> roles_db.get(username)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/admin/"</span>)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> admin_area(user: <span class="bu">dict</span> <span class="op">=</span> Depends(get_current_user)):</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> user[<span class="st">"role"</span>] <span class="op">!=</span> <span class="st">"admin"</span>:</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> HTTPException(status_code<span class="op">=</span><span class="dv">403</span>, detail<span class="op">=</span><span class="st">"Not authorized"</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"message"</span>: <span class="st">"Welcome to the admin area"</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>:</p>
<ul>
<li><strong>Roles</strong>: Weâve assigned roles (e.g., âadminâ, âuserâ) to each user.</li>
<li><strong>Authorization Check</strong>: We use the userâs role to allow or deny access to specific routes like <code>/admin/</code>.</li>
</ul>
</section>
<section id="protecting-against-common-vulnerabilities" class="level4">
<h4 class="anchored" data-anchor-id="protecting-against-common-vulnerabilities">4.3.3 Protecting Against Common Vulnerabilities</h4>
<p>In addition to authentication and authorization, itâs important to protect your FastAPI app against common security threats:</p>
<ul>
<li><strong>SQL Injection</strong>: Use parameterized queries or an ORM like SQLModel to avoid exposing your app to malicious SQL injection attacks.</li>
</ul>
<div class="sourceCode" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/users/"</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_users(name: <span class="bu">str</span>, session: Session <span class="op">=</span> Depends(get_session)):</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    statement <span class="op">=</span> select(User).where(User.name <span class="op">==</span> name)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> session.<span class="bu">exec</span>(statement).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p><strong>Cross-Site Scripting (XSS)</strong>: Always sanitize user inputs that are rendered back in the UI, especially if youâre interacting with frontend components.</p></li>
<li><p><strong>Cross-Site Request Forgery (CSRF)</strong>: FastAPI doesnât include CSRF protection by default, but you can integrate external packages or implement custom middleware to guard against CSRF attacks.</p></li>
<li><p><strong>Input Validation</strong>: FastAPIâs <strong>Pydantic</strong> models help you validate and sanitize inputs automatically. You should always ensure that the data users submit conforms to the expected format.</p></li>
</ul>
<div class="sourceCode" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> UserCreate(BaseModel):</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>    username: <span class="bu">str</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>    email: EmailStr  <span class="co"># This ensures a valid email format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="secure-coding-practices" class="level4">
<h4 class="anchored" data-anchor-id="secure-coding-practices">4.3.4 Secure Coding Practices</h4>
<p>Follow these best practices to keep your code secure:</p>
<ol type="1">
<li><strong>Limit Exposure</strong>: Only expose the routes that are necessary and avoid allowing external access to sensitive routes (e.g., admin areas).</li>
<li><strong>Use HTTPS</strong>: Always deploy your FastAPI application with HTTPS in production to encrypt all data between the client and server.</li>
<li><strong>Update Dependencies</strong>: Regularly update your dependencies to ensure youâre using the latest security patches.</li>
<li><strong>Environment Variables</strong>: Store sensitive information (like database credentials and secret keys) in environment variables, not in your codebase.</li>
<li><strong>Logging</strong>: Set up proper logging to monitor and detect suspicious activity.</li>
</ol>
</section>
</section>
<section id="performance-optimization" class="level3">
<h3 class="anchored" data-anchor-id="performance-optimization">4.4. Performance Optimization</h3>
<blockquote class="blockquote">
<p>âFaster is always better, right?â<br>
Speed is <strong>key</strong> when building APIs. Letâs make sure your FastAPI app can handle the pressureâwhether itâs 10 users or 10,000.</p>
</blockquote>
<p>Now that youâve built a secure and functional FastAPI app, itâs time to make it <em>fly</em> by focusing on performance optimization! Whether your app is running a high-traffic API, managing real-time data, or simply needs to be more responsive, performance optimization can make a big difference in user experience.</p>
<section id="why-optimize" class="level4">
<h4 class="anchored" data-anchor-id="why-optimize">4.4.1 Why Optimize?</h4>
<p>Imagine youâre using a writing app that checks your spelling and grammar in real time.</p>
<p>As you type, you expect instant feedbackâcorrections popping up seamlessly as you go. But what if thereâs a lag?</p>
<p>You write a sentence, and the corrections take five seconds to appear. It throws off your rhythm, you lose focus, and eventually, you might give up on the app altogether.</p>
<p>Thatâs how your users feel when your FastAPI app is slow.</p>
<p>They expect things to work instantly, especially for real-time features. If your app canât keep up with the demand, theyâll find another tool that can. This lesson will teach you how to optimize your FastAPI app so it stays responsive, even when itâs processing a lot of requests at once.</p>
</section>
<section id="caching-strategies-save-time-repeat-less" class="level4">
<h4 class="anchored" data-anchor-id="caching-strategies-save-time-repeat-less">4.4.2. Caching Strategies: Save Time, Repeat Less</h4>
<p>When your app processes the same requests repeatedly, caching can be a lifesaver. Instead of recalculating or re-fetching data for every request, caching lets you store previously computed responses and serve them up super fast.</p>
<p><strong>Example: Caching with <code>fastapi-cache</code></strong></p>
<ol type="1">
<li><strong>Installing the Required Package</strong>:</li>
</ol>
<div class="sourceCode" id="cb72"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install fastapi-cache2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li><strong>Implementing Basic Caching</strong>: Hereâs a simple way to cache the response of an endpoint using <code>fastapi-cache2</code>:</li>
</ol>
<div class="sourceCode" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi <span class="im">import</span> FastAPI</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi_cache <span class="im">import</span> FastAPICache</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastapi_cache.backends.redis <span class="im">import</span> RedisBackend</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> redis</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> FastAPI()</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a><span class="at">@app.on_event</span>(<span class="st">"startup"</span>)</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> startup():</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>    redis_client <span class="op">=</span> redis.Redis(host<span class="op">=</span><span class="st">"localhost"</span>, port<span class="op">=</span><span class="dv">6379</span>)</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>    FastAPICache.init(RedisBackend(redis_client), prefix<span class="op">=</span><span class="st">"fastapi-cache"</span>)</span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="at">@app.get</span>(<span class="st">"/items/</span><span class="sc">{item_id}</span><span class="st">"</span>)</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a><span class="at">@FastAPICache</span>(expire<span class="op">=</span><span class="dv">60</span>)  <span class="co"># Cache this response for 60 seconds</span></span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a><span class="cf">async</span> <span class="kw">def</span> get_item(item_id: <span class="bu">int</span>):</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Imagine this is an expensive operation like a database call</span></span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="st">"item_id"</span>: item_id, <span class="st">"description"</span>: <span class="st">"This is an item."</span>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>ð¥ <strong>Explanation</strong>: - <strong>Redis</strong>: We use Redis as a caching backend. Redis is a super fast in-memory data structure store, perfect for caching. - <strong>FastAPICache</strong>: This decorator caches the response of the <code>/items/{item_id}</code> endpoint for 60 seconds.</p>
<p><strong>Why Caching Matters</strong>:</p>
<ul>
<li><strong>Faster Responses</strong>: By storing responses, you reduce the time it takes to fetch data.</li>
<li><strong>Reduced Server Load</strong>: Youâre not hitting your database or performing expensive operations on every request.</li>
</ul>
</section>
<section id="asynchronous-optimization-handling-many-requests-like-a-champ" class="level4">
<h4 class="anchored" data-anchor-id="asynchronous-optimization-handling-many-requests-like-a-champ">4.4.3. Asynchronous Optimization: Handling Many Requests Like a Champ</h4>
<p>FastAPI shines when it comes to asynchronous programming. Unlike traditional synchronous frameworks, FastAPI can handle multiple requests concurrently, which means itâs great for high-performance use cases. <a href="#the-magic-of-asynchronicity">See in section 1. The magic of Asynchronicity</a></p>
</section>
<section id="profiling-and-benchmarking-measure-before-you-improve" class="level4">
<h4 class="anchored" data-anchor-id="profiling-and-benchmarking-measure-before-you-improve">4.4.4. Profiling and Benchmarking: Measure Before You Improve</h4>
<p>You canât improve what you donât measure! Profiling and benchmarking tools help you identify performance bottlenecks in your application so you know exactly where optimizations are needed.</p>
<p><strong>Tools for Profiling</strong>: - <strong>cProfile</strong>: Pythonâs built-in profiler. - <strong>py-spy</strong>: A sampling profiler that can show you where your app is spending most of its time, even in production.</p>
<p><strong>Example: Using <code>py-spy</code></strong></p>
<ol type="1">
<li><p><strong>Installing <code>py-spy</code></strong>: <code>bash     pip install py-spy</code></p></li>
<li><p><strong>Profiling your FastAPI app</strong>: <code>bash     py-spy top -- python3 -m uvicorn main:app</code></p></li>
</ol>
<p>This will show you a live breakdown of where your app is spending its CPU time. You can use this information to pinpoint slow parts of your code, like that unoptimized database query or the slow for-loop.</p>
<p><strong>Example: Measuring Latency with <code>timeit</code></strong></p>
<p>Hereâs a quick way to measure the latency of an endpoint using the <code>timeit</code> module:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timeit</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> measure():</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> requests.get(<span class="st">"http://localhost:8000/some-endpoint"</span>)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(timeit.timeit(measure, number<span class="op">=</span><span class="dv">10</span>))  <span class="co"># Run the request 10 times</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Remember, this section is optional but packed with advanced, exciting tools to supercharge your FastAPI skills!</p>
</section>
</section>
</section>
<section id="in-summary" class="level2">
<h2 class="anchored" data-anchor-id="in-summary">In Summary</h2>
<section id="asynchronicity-the-key-to-responsiveness" class="level3">
<h3 class="anchored" data-anchor-id="asynchronicity-the-key-to-responsiveness">Asynchronicity: The Key to Responsiveness</h3>
<p>Understanding asynchronous programming allows your FastAPI applications to handle multiple requests simultaneously, making them faster and more efficient. By leveraging <code>async</code> and <code>await</code>, your app can juggle tasks like a seasoned performer!</p>
</section>
<section id="routing-navigating-the-api-landscape" class="level3">
<h3 class="anchored" data-anchor-id="routing-navigating-the-api-landscape">Routing: Navigating the API Landscape</h3>
<p>Routing is crucial for directing requests to the appropriate endpoints. Youâve learned how to set up routes effectively, ensuring your users can access the functionality they need without a hitch.</p>
</section>
<section id="database-integration-persistence-made-easy" class="level3">
<h3 class="anchored" data-anchor-id="database-integration-persistence-made-easy">Database Integration: Persistence Made Easy</h3>
<p>We explored how to connect your FastAPI app with a database using SQLModel. By mastering CRUD operations, you can create, read, update, and delete data effortlessly, paving the way for dynamic applications.</p>
</section>
<section id="advanced-topics-toolbox-powering-up-your-skills" class="level3">
<h3 class="anchored" data-anchor-id="advanced-topics-toolbox-powering-up-your-skills">Advanced Topics Toolbox: Powering Up Your Skills</h3>
<p>We touched on various advanced topics, including dependency injection, testing, security measures, and performance optimization. These tools are essential for creating robust, secure, and high-performing applications that can handle the demands of modern users.</p>
<p>Now that weâve covered the advanced topics, letâs dive into <strong><a href="../01_Exercises/02_Lab.html">Lab 2</a></strong> and make your FastAPI apps <strong>secure, fast, and scalable</strong>! ðª</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Contenu adaptÃ© de <a href="https://sta210-s22.github.io/website/">STA 210: Regression Analysis</a><br> Tout le contenu est sous licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></p>
</div>   
    <div class="nav-footer-center">
<p><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 par <a href="https://www.linkedin.com/in/menyssacherifaluron/">MÃ©nyssa Cherifa-Luron</a></p>
</div>
    <div class="nav-footer-right">
<p>Fait avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/universdesdonnees/FASTAPICOURSE">Voir sur <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>